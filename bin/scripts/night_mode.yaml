#############
# Night mode
night_mode:
  alias: Night mode
  sequence:
    - alias: Turn on window light
      service: light.turn_on
      data:
        entity_id: light.hall_light
    - alias: Turn on bedroom light
      service: light.turn_on
      data:
        entity_id: light.bedroom_light
    - alias: Turn off tv
      service_template: >-
        {%- if is_state("sensor.tv_status", "on") -%}
        switch.turn_off
        {%- endif -%}
      data:
        entity_id: switch.tv_power
    - delay:
        seconds: 5
    - alias: Turn off sofa light
      service: switch.turn_off
      data:
        entity_id: switch.corner_light
    - delay:
        minutes: 1
    - alias: Turn off window light
      service: light.turn_off
      data:
        entity_id: light.hall_light        
    - delay:
        minutes: 9
    - alias: Turn off bedroom light
      service: light.turn_off
      data:
        entity_id: light.bedroom_light
    - alias: Set nest to night temperature
      service: climate.set_temperature
      data_template:
        entity_id: climate.living_room_butterfly
        temperature: >
          {%- if is_state("sensor.living_room_thermostat_butterfly_operation_mode", "heat") -%}
          71
          {%- else -%}
            {%- if is_state("sensor.living_room_thermostat_butterfly_operation_mode", "cool") -%}
            77
            {%- endif -%}
          {%- endif -%}
    - service: notify.rdpi
      data:
        message: Night-mode complete
