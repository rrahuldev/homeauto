#scripts
safe_mode:
  alias: Safe mode
  sequence:
    - alias: Turn off sofa light
      service: switch.turn_off
      data:
        entity_id: switch.corner_light
    - alias: Turn off tv
      service_template: >-
        {%- if is_state("sensor.tv_status", "on") -%}
        switch.turn_off
        {%- endif -%}
      data:
        entity_id: switch.tv_power
    - alias: Turn off bedroom light
      service: light.turn_off
      data:
        entity_id: light.bedroom_light        
    - alias: Turn off window light if sun is above horizon
      service_template: >-
        {%- if is_state("sun.sun", "above_horizon") -%}       
        light.turn_off
        {%- else -%}
        light.turn_on
        {%- endif -%}
      data:
        entity_id: light.hall_light
    - alias: Turn of tv
      service_template: >-
        {%- if is_state("binary_sensor.tv_state", "on") -%}
        script.media_off
        {%- endif -%}
    - delay:
        # supports seconds, milliseconds, minutes, hours
        minutes: 1
    - alias: Nest to away
      service: climate.set_away_mode
      data:
        entity_id: climate.living_room_butterfly
        away_mode: true
    - service: notify.rdpi
      data:
        message: Safe-mode complete
